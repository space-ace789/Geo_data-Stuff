<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geodata Assignment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Geodata_assignment_files/libs/clipboard/clipboard.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/quarto.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/popper.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/anchor.min.js"></script>
<link href="Geodata_assignment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Geodata_assignment_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Geodata_assignment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Geodata_assignment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Geodata_assignment_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up</a></li>
  <li><a href="#distribution-modelling" id="toc-distribution-modelling" class="nav-link" data-scroll-target="#distribution-modelling">Distribution Modelling</a></li>
  <li><a href="#distribution-overlap" id="toc-distribution-overlap" class="nav-link" data-scroll-target="#distribution-overlap">Distribution Overlap</a></li>
  <li><a href="#modelling-interspecies-distribution-dependence" id="toc-modelling-interspecies-distribution-dependence" class="nav-link" data-scroll-target="#modelling-interspecies-distribution-dependence">Modelling Interspecies Distribution Dependence</a></li>
  <li><a href="#future-distribution-prediction" id="toc-future-distribution-prediction" class="nav-link" data-scroll-target="#future-distribution-prediction">Future Distribution Prediction</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Geodata Assignment</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The two species I have chosen to look at are the Fisher (<em>Pekania pennanti</em>) and the North American Porcupine (<em>Erethizon dorsatum</em>). Fishers and Porcupines have a predator-prey relationship, therefore I expect their ranges to have limited overlap.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set Up</h2>
<section id="packages-used" class="level4">
<h4 class="anchored" data-anchor-id="packages-used">Packages used:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dismo)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rworldmap)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-in-a-world-map" class="level4">
<h4 class="anchored" data-anchor-id="load-in-a-world-map">Load in a World Map:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">getMap</span>(<span class="at">resolution =</span> <span class="st">"coarse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-species-coordinate-datasets" class="level4">
<h4 class="anchored" data-anchor-id="creating-species-coordinate-datasets">Creating Species Coordinate Datasets:</h4>
<p>To create the datasets first the the species data is downloaded from GBIF. This includes a lot of information not required for species distribution modelling. Therefore only the latitude and longitude data is extracted from the large dataset using the coordinate extraction function (see below). Species data was taken from GBIF data network, <a href="https://www.gbif.org/" class="uri">https://www.gbif.org/</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Coordinate extration function</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This code extracts just the longitude and latitude (coordinate data) values from the GBIF data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>extract_coordinates <span class="ot">&lt;-</span> <span class="cf">function</span>(speciesdata.gbif) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(speciesdata.gbif<span class="sc">$</span>lon, speciesdata.gbif<span class="sc">$</span>lat) <span class="sc">%&gt;%</span> <span class="co">#Combines the long atnd lat data to create coordinates</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="co">#converts the list into a dataframe object</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To ensure only coordinates within continental landmasses were included any points that intersected with a map of ocean coordinates were removed. The ocean coordinates were taken from the natural earth dataset, <a href="https://naturalearth.s3.amazonaws.com/110m_physical/ne_110m_ocean.zip" class="uri">https://naturalearth.s3.amazonaws.com/110m_physical/ne_110m_ocean.zip</a>.</p>
</section>
<section id="loading-and-extracting-climate-variables" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-extracting-climate-variables">Loading and Extracting Climate Variables:</h4>
<p>To create a model predicting species distribution based on climate variables you also need a dataset of various climate measurements from the area covered by the species dataset coordinates. Climate data was downloaded from the worldclim database, <a href="https://www.worldclim.org/" class="uri">https://www.worldclim.org/</a>.</p>
<p>The climate variables specific to the range of the chosen species are then extracted from the wider dataset and combined with the coordinate data to create the final processed datasets on which our models will be based.</p>
</section>
</section>
<section id="distribution-modelling" class="level2">
<h2 class="anchored" data-anchor-id="distribution-modelling">Distribution Modelling</h2>
<section id="species-1-fisher" class="level4">
<h4 class="anchored" data-anchor-id="species-1-fisher">Species 1 (Fisher)</h4>
<p>The data downloaded from GBIF only contains data on presence, absence was not recorded. Absence data is required to run the models therefore pseudoabsence data was created by randomly generating 500 points within the study area of each species. This was done using the code below.</p>
<div class="cell">
<details class="code-fold">
<summary>Generation of Pseudoabsence Data</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co">#seed used so that the randomly generated absence points are the same each time so that analysis can be consistent. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>species1_bg <span class="ot">&lt;-</span> <span class="fu">randomPoints</span>(species1_extent_mask, <span class="dv">500</span>, <span class="at">ext=</span>species1_extent) <span class="co">#generates the pseudoabsence points. </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(species1_bg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>) <span class="co">#assigns names to the columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The ability of different climate variables to predict the presence absence data was then compared by creating a set of generalised linear models. The models assume binomial errors as the presence absence data is binary data. In total five models were created each containing 3-4 of the climate variables, as this number of variables per model which was small enough to prevent issues of multiple colinearity resulting in singularities and overfitting.</p>
<p><u>Model Summaries and AIC:</u></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio1 + bio2 + bio3 + bio4, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 21.5530421  1.3634661  15.808  &lt; 2e-16 ***
bio1         0.1624200  0.0198623   8.177 2.90e-16 ***
bio2         0.5047900  0.0736122   6.857 7.01e-12 ***
bio3        -0.4860906  0.0332938 -14.600  &lt; 2e-16 ***
bio4        -0.0109573  0.0009384 -11.677  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2943.6  on 6307  degrees of freedom
AIC: 2953.6

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio5 + bio6 + bio7 + bio8, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.355e+00  7.016e-01   3.357 0.000788 ***
bio5        -4.992e+04  3.923e+04  -1.272 0.203245    
bio6         4.992e+04  3.923e+04   1.272 0.203244    
bio7         4.992e+04  3.923e+04   1.272 0.203245    
bio8         1.662e-02  8.824e-03   1.883 0.059644 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 3372.7  on 6307  degrees of freedom
AIC: 3382.7

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio9 + bio10 + bio11 + bio12, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.0444301  0.5275894  -3.875 0.000107 ***
bio9        -0.0763295  0.0092896  -8.217  &lt; 2e-16 ***
bio10        0.0332500  0.0240264   1.384 0.166391    
bio11        0.0675660  0.0182837   3.695 0.000220 ***
bio12        0.0050917  0.0002272  22.412  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2721.0  on 6307  degrees of freedom
AIC: 2731

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>Model containing climate variables 13, 14, 15, and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio13 + bio14 + bio15 + bio16, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.430714   0.397551   8.630  &lt; 2e-16 ***
bio13       -0.076640   0.014358  -5.338 9.42e-08 ***
bio14       -0.033002   0.006663  -4.953 7.31e-07 ***
bio15       -0.083754   0.007425 -11.280  &lt; 2e-16 ***
bio16        0.038476   0.005015   7.672 1.70e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2634.3  on 6307  degrees of freedom
AIC: 2644.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>Model containing climate variables 17, 18, and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio17 + bio18 + bio19, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.2916219  0.2191538 -10.457  &lt; 2e-16 ***
bio17        0.0056914  0.0013397   4.248 2.16e-05 ***
bio18        0.0126564  0.0010758  11.765  &lt; 2e-16 ***
bio19        0.0052539  0.0006468   8.122 4.57e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2753.0  on 6308  degrees of freedom
AIC: 2761

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 1: Tables showing summary statistics for each generalised linear model of the effect of climate on species 1 distribution.</p>
<p>All models were able to somewhat predict the distribution of fishers, however variable 10 as well as all of the variables in model 2 do not appear to be as important for predicting distribution as some of the other variables.</p>
<p>To compare how well each model predicts the presence/absence of fishers an Akaike Information Criterion test was performed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              df      AIC
species1_glm1  5 2953.616
species1_glm2  5 3382.732
species1_glm3  5 2730.988
species1_glm4  5 2644.323
species1_glm5  4 2760.966</code></pre>
</div>
</div>
<p>Figure 2: Table comparing the AIC values of the five models for species 1.</p>
<p>Model 4 has the lowest AIC value and is therefore the best model for predicting fisher distribution, out of those created in this analysis and based on this set of 19 climate variables. This suggests that precipitation of the wettest and driest months, precipitation seasonality and precipitation of the wettest quarter are all very important in determining fisher distribution. The fact that model 4, which contains only variables related to precipitation, was the best model may suggest that precipitation has a stronger effect on fisher distribution than temperature. Although temperature does still appear to have an effect.</p>
<p><u>Evaluating AUC and correlation of models:</u></p>
<p>The ability of a models predictions to match the observed data can also be evaluated by looking at the area under the curve (AUC) and correlation (cor) values.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7382369 
cor            : 0.3412544 
max TPR+TNR at : 2.21038 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.5742318 
cor            : 0.1448049 
max TPR+TNR at : 2.188867 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7585594 
cor            : 0.3741869 
max TPR+TNR at : 2.223178 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>Model containing climate variables 13, 14, 15, and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7912066 
cor            : 0.4386138 
max TPR+TNR at : 2.407037 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<p>Model containing climate variables 17, 18, and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7538322 
cor            : 0.3692391 
max TPR+TNR at : 2.157795 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 3: Tables showing the AUC and cor values of each model for species 1.</p>
<p>The results of evaluating the models using AUC and cor values matched those done by comparing the model AIC values. Model 4 had both the highest AUC and the highest correlation. However its cor values was just below 0.5 suggesting that the correlation between these model predictions and the observed distributions are of moderate strength at best. Potentially a model which combines data on precipitation and temperature might have provide more accurate predictions. This could also suggest that non-climate variables are also important in determining the distribution of fishers e.g.&nbsp;interactions with other species.</p>
<p>As model 4 is consistently shown to be the best model at predicting fisher distribution (out of those created in this analysis) this is the one which will be used to map current distribution of fishers.</p>
<p><u>Mapping current distribution:</u></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plot%20species%201%20GLM%20predictions-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 4: Map showing predicted probabilites of species 1 occurence based on predictions from model 4.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Species%201%20Presence%20and%20Absence%20plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 5: Map showing current predicted areas of Presence and Absence for species 1 based on model 4.</figcaption>
</figure>
</div>
</div>
</div>
<p>The distribution predicted by the model matches the observed data to a certain extent. The high probabilities of occurence found across the entire East side of North America and along the Western coast, especially moving up into Canada both line up with the two main clusters of Fisher presence shown by the GBIF data. However the model mostly misses the group of fishers which inhabit central Canada. On the Eastern coast the area’s of predicted high probability also extend further south and north than observed data. As model four only includes information on precipitation it is possible adding temperature would restrict the latitudinal range predicted by the model. The binary presence absence map predicts the current distribution of fishers to be split into two distinct populations, one larger one occupying most of Eastern Canada and the US and a smaller one running along the West Coast. While these are the two main clusters seen on observed data from GBIF the actual distribution of Fishers appears to run in a continuous band across the continent. This also suggests that factors other than climate, or at least other than those in model 4, are important to consider when predicting fisher distribution.</p>
</section>
<section id="species-2-north-american-porcupine" class="level4">
<h4 class="anchored" data-anchor-id="species-2-north-american-porcupine">Species 2 (North American Porcupine)</h4>
<p><u>Model Summaries and AIC:</u></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio1 + bio2 + bio3 + bio4, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 19.354475   0.845817  22.883  &lt; 2e-16 ***
bio1         0.092340   0.012472   7.404 1.32e-13 ***
bio2         0.653465   0.035380  18.470  &lt; 2e-16 ***
bio3        -0.419107   0.016891 -24.813  &lt; 2e-16 ***
bio4        -0.011098   0.000571 -19.435  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4569.2  on 18121  degrees of freedom
Residual deviance: 3813.2  on 18117  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 3823.2

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio5 + bio6 + bio7 + bio8, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.955e+00  4.326e-01   4.521 6.17e-06 ***
bio5         6.343e+04  3.928e+04   1.615    0.106    
bio6        -6.343e+04  3.928e+04  -1.615    0.106    
bio7        -6.343e+04  3.928e+04  -1.615    0.106    
bio8        -4.525e-02  8.538e-03  -5.300 1.16e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4569.2  on 18121  degrees of freedom
Residual deviance: 4378.1  on 18117  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 4388.1

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio9 + bio10 + bio11 + bio12, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 1.7298829  0.3927317   4.405 1.06e-05 ***
bio9        0.0020425  0.0074304   0.275 0.783408    
bio10       0.0581516  0.0173469   3.352 0.000801 ***
bio11       0.0387746  0.0146505   2.647 0.008130 ** 
bio12       0.0013511  0.0001409   9.591  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4569.2  on 18121  degrees of freedom
Residual deviance: 4318.6  on 18117  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 4328.6

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>Model containing climate variables 13, 14, 15, and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio13 + bio14 + bio15 + bio16, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.539140   0.274975  16.507  &lt; 2e-16 ***
bio13        0.020119   0.007670   2.623  0.00872 ** 
bio14        0.008476   0.004540   1.867  0.06192 .  
bio15       -0.030231   0.004656  -6.493 8.43e-11 ***
bio16       -0.007782   0.002614  -2.977  0.00291 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4569.2  on 18121  degrees of freedom
Residual deviance: 4241.1  on 18117  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 4251.1

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>Model containing climate variables 17, 18, and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio17 + bio18 + bio19, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.3560634  0.1253574  26.772  &lt; 2e-16 ***
bio17        0.0158805  0.0009937  15.981  &lt; 2e-16 ***
bio18       -0.0062160  0.0006553  -9.485  &lt; 2e-16 ***
bio19       -0.0020855  0.0004343  -4.802 1.57e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4569.2  on 18121  degrees of freedom
Residual deviance: 4239.7  on 18118  degrees of freedom
  (5 observations deleted due to missingness)
AIC: 4247.7

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 6: Tables showing summary statistics for each generalised linear model of the effect of climate on species 2 distribution.</p>
<p>For the North American Porcupine only three of the models are able to significantly predict occurrence, models 1, 4, 5. Although the predictive power of model 4 may mostly rely on just one variable, variable 15 (precipitation seasonality).</p>
<p>To compare how well each model predicts the presence/absence of the North American Porcupine an Akaike Information Criterion test was performed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              df      AIC
species2_glm1  5 3823.151
species2_glm2  5 4388.149
species2_glm3  5 4328.638
species2_glm4  5 4251.094
species2_glm5  4 4247.674</code></pre>
</div>
</div>
<p>Figure 7: Table comparing the AIC values of the five models for species 2.</p>
<p>The model with the lowest AIC value is model 1, which indicates annual mean temperature, mean diurnal range, isothermality and temperature seasonality are all important factors in determining porcupine distribution. However as the other two models containing primarily variables linked to temperature had very limited predictive ability the role. of precipitation cannot fully be discounted as both models 4 and 5 had lower AICS than models 2 and 4. In general all of the models for species 2 had higher AIC’s than the models for species 1 which suggests that climate is not as important in controlling the range of porcupines as it is for fishers.</p>
<p><u>Evaluating AUC and correlation of models:</u></p>
<p>The ability of a models predictions to match the observed data can also be evaluated by looking at the area under the curve (AUC) and correlation (cor) values.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 499 
AUC            : 0.7084946 
cor            : 0.2946213 
max TPR+TNR at : 3.07035 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 499 
AUC            : 0.6024606 
cor            : 0.1038597 
max TPR+TNR at : 2.917048 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 499 
AUC            : 0.6460043 
cor            : 0.1236925 
max TPR+TNR at : 3.253467 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<p>Model containing climate variables 13, 14, 15, and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 499 
AUC            : 0.7276885 
cor            : 0.1435838 
max TPR+TNR at : 3.933495 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<p>Model containing climate variables 17, 18, and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 499 
AUC            : 0.7275213 
cor            : 0.1341399 
max TPR+TNR at : 3.860463 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 8: Tables showing the AUC and cor values of each model for species 2.</p>
<p>The results of the evaluation of AUC and cor values are consistent with the AIC values of the models, with model 1 showing the highest AUC and cor values. However the correlation of model one was around 0.3. Suggesting that even though it is the best model it is still quite poor at predicting porcupine distribution. Strengthening the argument that climate is not the main factor determining the range of the North American Porcupine. As it is the best model created in this analysis at explaining</p>
<p><u>Mapping current distribution:</u></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20species%202%20current%20distribution-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 9: Map showing predicted probabilites of species 2 occurence based on predictions from model 1.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Species%202%20Presence%20and%20Absence%20plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 10: Map showing current predicted areas of Presence and Absence for species 2 based on model 1.</figcaption>
</figure>
</div>
</div>
</div>
<p>In general the observed data from the GBIF dataset matches with areas predicted by the model to have a high chance of occurence. However the model slightly under estimates the latitudinal range of the porcupine with several presence coordinates falling both above and below the main region of predicted occupation. The binary presence absence map does not include the majority of the large cluster of observations found in central and western America. This model of current distribution actually significantly underestimates the range of porcupines. Similarly to the fisher data it shows two completely separate populations despite the real life observations suggesting otherwise. According to both maps we would expect the climate conditions in south-eastern America to support porcupine habitation. However very few based on the GBIF data there are very few porcupines here potentially this area is lacking other important features such as corrected habitat type or an important food plant.</p>
<p>Overall the current distributions of fishers and porcupines are fairly similar, therefore we would expect a high degree of overlap.</p>
</section>
</section>
<section id="distribution-overlap" class="level2">
<h2 class="anchored" data-anchor-id="distribution-overlap">Distribution Overlap</h2>
<section id="plotting" class="level4">
<h4 class="anchored" data-anchor-id="plotting">Plotting</h4>
<p>Although simply from visually observing the maps of current distribution for both species it is clear they have a large degree of overlap it is still useful to plot maps of the overlap to confirm this. To create fig 11 the results of the predictions for current distribution of each species were combined into one dataset. In the original prediction models the chance the the species will occur in an area is ranked on a scale of 0-1 with higher numbers indicating a higher chance the species will be found there. By combining these datasets in a summative way it creates a dataframe where values around 1 indicate only one species is found in the area and values approaching 2 show that both species are likely to occur</p>
<div class="cell">
<details class="code-fold">
<summary>Creating combined datasets code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">mosaic</span>(species1_pred, species2_pred, <span class="at">fun =</span> <span class="st">"sum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20predicted%20probability%20of%20both%20species%20occuring%20between%20the%20current%20distributions-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 11: Map showing the probability that between 0 and 1 species occur in a certain area, yellow represents high likelihood of both species occuring and therefore areas of overlap</figcaption>
</figure>
</div>
</div>
</div>
<p>The individual thresholds for presence of species 1 and 2 were added together to create a threshold above which you would expect both species to occur, therefore allowing us to predict areas of overlapping distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plot%20sympatric%20and%20non-sympatric%20areas-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 12: Map showing areas of sympatry between species 1 and 2</figcaption>
</figure>
</div>
</div>
</div>
<p>The majority of sympatric areas predicted by the models occur in the USA, particularly the Eastern side of it. There is also a small amount of overlap predicted reaching up along the south eastern and south western coast of Canada.</p>
</section>
<section id="metrics" class="level4">
<h4 class="anchored" data-anchor-id="metrics">Metrics</h4>
<p>The degree of overlap can be calculated by finding the sum of predicted localities at which sympatry occurs, based on the threshold created to make fig 12, a dataset combining coordinates from both species and the spatial data mapping occurence of both species, from figure 11. This is then expressed as a proportion of the total coordinates for both species. This will allows the metric to be compared across different species pairs without being affected by the number of coordinates available for each species. See code below for how to calculate. Therefore the final metric of degree of overlap is expressed as the proportion of total coordinates for each species which are above the 2 species occurence threshold.</p>
<div class="cell">
<details class="code-fold">
<summary>Degree of Overlap Calculation</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>overlap_localities <span class="ot">&lt;-</span> <span class="fu">extract</span>(combined <span class="sc">&gt;=</span> (species2_tr<span class="sc">+</span>species1_tr), combined_coords) <span class="co">#Extracts which localities within the combined coordinates of both species</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>overlap_metric <span class="ot">&lt;-</span> (<span class="fu">sum</span>(overlap_localities <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span><span class="fu">length</span>(combined_coords<span class="sc">$</span>lon) <span class="co">#calculates the total sum of localities and divides them by the total number of coordinates for both species. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5911942</code></pre>
</div>
</div>
<p>Just under 60% of localities for Fishers and North American Porcupines are expected to overlap.</p>
</section>
</section>
<section id="modelling-interspecies-distribution-dependence" class="level2">
<h2 class="anchored" data-anchor-id="modelling-interspecies-distribution-dependence">Modelling Interspecies Distribution Dependence</h2>
<p>To test whether there is an effect of species</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>adfshjfahjkafkhj <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lon =</span> species2_combined_coords<span class="sc">$</span>lon, <span class="at">lat =</span> species2_combined_coords<span class="sc">$</span>lat, species2_pa_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="future-distribution-prediction" class="level2">
<h2 class="anchored" data-anchor-id="future-distribution-prediction">Future Distribution Prediction</h2>
<p>To predict the future distribution of species future climate projections are required to provide data to run the previously created models on. The projection data used here was from CMIP5 (Coupled Model Intercomparison Project Phase 5), which is available here <a href="https://aims2.llnl.gov/search" class="uri">https://aims2.llnl.gov/search</a>.</p>
<section id="species-1" class="level4">
<h4 class="anchored" data-anchor-id="species-1">Species 1</h4>
<p>Future climate predictions are based off model 4 as this was the best at predicting current distribution for fishers. Future predictions were calculated by running a prediction based of the original model 4 but using the new projection climate data as opposed to the current climate data.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20future%20distributions%20for%20species%201-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 13: Maps comparing the Present GLM Occurences and Distributions of Species 1 with those based on Climate Projections for 2060-2081</figcaption>
</figure>
</div>
</div>
</div>
<p>There is very little, if any change in the future distribution of fishers linked to climate change based on these models. There is a slight loss of connectivity within the western population. On the other hand the Eastern population shows a slight range expansion northwards into Quebec. Overall fishers are predicted by these models to be able to retain most of their current distribution, with potential for a small range expansion northwards in certain areas.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Range change metrics:"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Current suitable localities: 5128"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Future suitable localities: 5050"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of new suitable localities (expansion): 85"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of lost suitable localities (contraction): 93"</code></pre>
</div>
</div>
<p>As predicted from looking at the maps of distribution changes there is very little difference in the current and future predicted range of fishers. The species undergoes both range expansions and contractions, with very small net contraction of range expected in the future.</p>
</section>
<section id="species-2" class="level4">
<h4 class="anchored" data-anchor-id="species-2">Species 2</h4>
<p>Future climate predictions are based off model 1 as this was the best at predicting current distribution for Porcupines. Future predictions were calculated in the same way as for species 1.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20future%20distributions%20of%20species%202-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 14: Maps comparing the present GLM Occurences and Distributions of Species 2 with those based on Climate Projections for 2060-2081</figcaption>
</figure>
</div>
</div>
</div>
<p>The range of North American Porcupines is expected in increase significantly, with large expansions both North and South of the current range. Based on climate data alone is appears that climate change could allow porcupines to colonise all of the United States as well as most regions of Canada except the centre. However this increase in range would include a shift in habitat from grasslands and temperate forest towards boreal forests and tundra in the North and tropical forests in the South (NABCI, 2016). Therefore in reality if climate changes are not accompanied by an expansion of the preferred habitat of porcupines then they might not be able to fully track the climate changes, limiting the observed range expansion. However similar to the fishers these results suggest that under current predictions of climate change porcupines would be expected to at a minimum maintain their current distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>species2_localities <span class="ot">&lt;-</span> <span class="fu">extract</span>(species2_pred <span class="sc">&gt;=</span> species2_tr, species2_coords)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>species2_current_range <span class="ot">&lt;-</span> <span class="fu">sum</span>(species2_localities, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>species2_future_localities <span class="ot">&lt;-</span> <span class="fu">extract</span>(species2_future_pred <span class="sc">&gt;=</span> species2_tr, species2_coords)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>species2_future_range <span class="ot">&lt;-</span> <span class="fu">sum</span>(species2_future_localities, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>species2_range_expansion <span class="ot">&lt;-</span> <span class="fu">sum</span>((species2_localities <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&amp;</span> (species2_future_localities <span class="sc">==</span> <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>species2_range_contraction <span class="ot">&lt;-</span> <span class="fu">sum</span>((species2_localities <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (species2_future_localities <span class="sc">==</span> <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Range change metrics:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Range change metrics:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Current suitable localities:"</span>, species2_current_range))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Current suitable localities: 9336"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Future suitable localities:"</span>, species2_future_range))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Future suitable localities: 16551"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of new suitable localities (expansion):"</span>, species2_range_expansion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of new suitable localities (expansion): 7971"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of lost suitable localities (contraction):"</span>, species2_range_contraction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of lost suitable localities (contraction): 0"</code></pre>
</div>
</div>
<p>As shown by the maps in fig 14 there is a large increase in predicted distribution of the North American Porcupine,</p>
</section>
<section id="degree-of-overlap" class="level4">
<h4 class="anchored" data-anchor-id="degree-of-overlap">Degree of Overlap</h4>
<p>As the range of each individual species shifts the degree of overlap between the two species is also expected to change.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20future%20degree%20of%20overlap-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 15: Maps comparing the present GLM Occurence overlap and Distributions of Overlap with those based on Climate Projections for 2060-2081</figcaption>
</figure>
</div>
</div>
</div>
<p>The maps above show that the overlap in distribution between Fishers and North American Porcupines is expected to increase in the future. In particular sympatric area’s in the future are expected to expand up the East coast of Canada, where currently they are mostly confined to the US. There are also expected to gain some new areas of overlap in the mid-western US. This increase in overlap is probably mostly due to the expansion of porcupines northward into Canada and their predicted future colonisation of the entire US as fishers have very little change in distribution between the present and future conditions. The GLM Occurence models as show that as well as the area in which they overlap increasing the general probability that both species co-occur across the region also increases.</p>
<div class="cell">
<details class="code-fold">
<summary>Degree of Overlap Calculation</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>future_overlap_localities <span class="ot">&lt;-</span> <span class="fu">extract</span>(combined_future <span class="sc">&gt;</span> (species2_tr<span class="sc">+</span>species1_tr), combined_coords)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>future_overlap_metric <span class="ot">&lt;-</span> (<span class="fu">sum</span>(future_overlap_localities <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span><span class="fu">length</span>(combined_coords<span class="sc">$</span>lon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6593285</code></pre>
</div>
</div>
<p>In the future the degree of overlap is predicted to be around 66% which is large than the metric calculated for current distributions. This matches with the maps of how areas of sympatry will change seen in fig 15, which also predict an increase in the amount of locations where the two species overlap.</p>
</section>
</section>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>