<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geodata Assignment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Geodata_assignment_files/libs/clipboard/clipboard.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/quarto.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/popper.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Geodata_assignment_files/libs/quarto-html/anchor.min.js"></script>
<link href="Geodata_assignment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Geodata_assignment_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Geodata_assignment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Geodata_assignment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Geodata_assignment_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up</a></li>
  <li><a href="#distribution-modelling" id="toc-distribution-modelling" class="nav-link" data-scroll-target="#distribution-modelling">Distribution Modelling</a></li>
  <li><a href="#distribution-overlap" id="toc-distribution-overlap" class="nav-link" data-scroll-target="#distribution-overlap">Distribution Overlap</a></li>
  <li><a href="#modelling-interspecies-distribution-dependence" id="toc-modelling-interspecies-distribution-dependence" class="nav-link" data-scroll-target="#modelling-interspecies-distribution-dependence">Modelling Interspecies Distribution Dependence</a></li>
  <li><a href="#future-distribution-prediction" id="toc-future-distribution-prediction" class="nav-link" data-scroll-target="#future-distribution-prediction">Future Distribution Prediction</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Geodata Assignment</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The two species I have chosen to look at are the Fisher (<em>Pekania pennanti</em>) and the North American Porcupine (<em>Erethizon dorsatum</em>). Fishers and Porcupines have a predator-prey relationship, therefore I expect their ranges to have limited overlap.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set Up</h2>
<section id="packages-used" class="level4">
<h4 class="anchored" data-anchor-id="packages-used">Packages used:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dismo)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rworldmap)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-in-a-world-map" class="level4">
<h4 class="anchored" data-anchor-id="load-in-a-world-map">Load in a World Map:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">getMap</span>(<span class="at">resolution =</span> <span class="st">"coarse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-species-coordinate-datasets" class="level4">
<h4 class="anchored" data-anchor-id="creating-species-coordinate-datasets">Creating Species Coordinate Datasets:</h4>
<p>To create the datasets first the the species data is downloaded from GBIF. This includes a lot of information not required for species distribution modelling. Therefore only the latitude and longitude data is extracted from the large dataset using the coordinate extraction function (see below). Species data was taken from GBIF data network, <a href="https://www.gbif.org/" class="uri">https://www.gbif.org/</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Coordinate extration function</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This code extracts just the longitude and latitude (coordinate data) values from the GBIF data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>extract_coordinates <span class="ot">&lt;-</span> <span class="cf">function</span>(speciesdata.gbif) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(speciesdata.gbif<span class="sc">$</span>lon, speciesdata.gbif<span class="sc">$</span>lat) <span class="sc">%&gt;%</span> <span class="co">#Combines the long atnd lat data to create coordinates</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="co">#converts the list into a dataframe object</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To ensure only coordinates within continental landmasses were included any points that intersected with a map of ocean coordinates were removed. The ocean coordinates were taken from the natural earth dataset, <a href="https://naturalearth.s3.amazonaws.com/110m_physical/ne_110m_ocean.zip" class="uri">https://naturalearth.s3.amazonaws.com/110m_physical/ne_110m_ocean.zip</a>.</p>
</section>
<section id="loading-and-extracting-climate-variables" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-extracting-climate-variables">Loading and Extracting Climate Variables:</h4>
<p>To create a model predicting species distribution based on climate variables you also need a dataset of various climate measurements from the area covered by the species dataset coordinates. Climate data was downloaded from the worldclim database, <a href="https://www.worldclim.org/" class="uri">https://www.worldclim.org/</a>.</p>
<p>The climate variables specific to the range of the chosen species are then extracted from the wider dataset and combined with the coordinate data to create the final processed datasets on which our models will be based.</p>
</section>
</section>
<section id="distribution-modelling" class="level2">
<h2 class="anchored" data-anchor-id="distribution-modelling">Distribution Modelling</h2>
<section id="species-1-fisher" class="level4">
<h4 class="anchored" data-anchor-id="species-1-fisher">Species 1 (Fisher)</h4>
<p>The data downloaded from GBIF only contains data on presence, absence was not recorded. Absence data is required to run the models therefore pseudoabsence data was created by randomly generating 500 points within the study area of each species. This was done using the code below.</p>
<div class="cell">
<details class="code-fold">
<summary>Generation of Pseudoabsence Data</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>species1_bg <span class="ot">&lt;-</span> <span class="fu">randomPoints</span>(species1_extent_mask, <span class="dv">500</span>, <span class="at">ext=</span>species1_extent) <span class="co">#generates the pseudoabsence points. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(species1_bg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>) <span class="co">#assigns names to the columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The ability of different climate variables to predict the presence absence data was then compared by creating a set of generalised linear models. The models assume binomial errors as the presence absence data is binary data. In total five models were created each containing 3-4 of the climate variables, as this number of variables per model which was small enough to prevent issues of multiple colinearity resulting in singularities and overfitting.</p>
<p><u>Model Summaries and AIC:</u></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio1 + bio2 + bio3 + bio4, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 19.2789636  1.3731679  14.040  &lt; 2e-16 ***
bio1         0.2067977  0.0197913  10.449  &lt; 2e-16 ***
bio2         0.5082776  0.0758463   6.701 2.06e-11 ***
bio3        -0.4614277  0.0342634 -13.467  &lt; 2e-16 ***
bio4        -0.0096810  0.0009434 -10.262  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2872.5  on 6307  degrees of freedom
AIC: 2882.5

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio5 + bio6 + bio7 + bio8, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.466e+00  6.997e-01   2.095   0.0362 *  
bio5        -4.712e+04  4.013e+04  -1.174   0.2403    
bio6         4.712e+04  4.013e+04   1.174   0.2403    
bio7         4.712e+04  4.013e+04   1.174   0.2403    
bio8         3.433e-02  8.809e-03   3.897 9.75e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 3253.8  on 6307  degrees of freedom
AIC: 3263.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio9 + bio10 + bio11 + bio12, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.1968584  0.5249031  -4.185 2.85e-05 ***
bio9        -0.0858517  0.0093369  -9.195  &lt; 2e-16 ***
bio10        0.0493886  0.0242320   2.038   0.0415 *  
bio11        0.0858725  0.0183666   4.675 2.93e-06 ***
bio12        0.0051510  0.0002374  21.701  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2637.8  on 6307  degrees of freedom
AIC: 2647.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>Model containing climate variables 13, 14, 15 and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio13 + bio14 + bio15 + bio16, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.732213   0.396962   6.883 5.87e-12 ***
bio13       -0.092620   0.014913  -6.210 5.28e-10 ***
bio14       -0.025505   0.006781  -3.761 0.000169 ***
bio15       -0.074284   0.007393 -10.047  &lt; 2e-16 ***
bio16        0.044634   0.005203   8.578  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2600.6  on 6307  degrees of freedom
AIC: 2610.6

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>Model containing climate variables 17, 18 and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio17 + bio18 + bio19, family = binomial(link = "logit"), 
    data = species1_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.5699146  0.2201312 -11.674  &lt; 2e-16 ***
bio17        0.0052014  0.0013713   3.793 0.000149 ***
bio18        0.0139804  0.0010959  12.757  &lt; 2e-16 ***
bio19        0.0056170  0.0006512   8.625  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3494.9  on 6311  degrees of freedom
Residual deviance: 2677.3  on 6308  degrees of freedom
AIC: 2685.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 1: Tables showing summary statistics for each generalised linear model of the effect of climate on species 1 distribution.</p>
<p>All models were able to somewhat predict the distribution of fishers, however variable 10 as well as all of the variables in model 2 do not appear to be as important for predicting distribution as some of the other variables.</p>
<p>To compare how well each model predicts the presence/absence of fishers an Akaike Information Criterion test was performed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              df      AIC
species1_glm1  5 2882.463
species1_glm2  5 3263.764
species1_glm3  5 2647.802
species1_glm4  5 2610.578
species1_glm5  4 2685.342</code></pre>
</div>
</div>
<p>Figure 2: Table comparing the AIC values of the five models for species 1.</p>
<p>Model 4 has the lowest AIC value and is therefore the best model for predicting fisher distribution, out of those created in this analysis and based on this set of 19 climate variables. This suggests that precipitation of the wettest and driest months, precipitation seasonality and precipitation of the wettest quarter are all very important in determining fisher distribution. The fact that model 4, which contains only variables related to precipitation, was the best model may suggest that precipitation has a stronger effect on fisher distribution than temperature. Although temperature does still appear to have an effect.</p>
<p><u>Evaluating AUC and correlation of models:</u></p>
<p>The ability of a models predictions to match the observed data can also be evaluated by looking at the area under the curve (AUC) and correlation (cor) values.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7347894 
cor            : 0.3698676 
max TPR+TNR at : 2.215975 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.623073 
cor            : 0.210653 
max TPR+TNR at : 2.043155 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7779752 
cor            : 0.393391 
max TPR+TNR at : 2.24416 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>Model containing climate variables 13, 14, 15 and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7997206 
cor            : 0.4329804 
max TPR+TNR at : 2.317599 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<p>Model containing climate variables 17, 18 and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 5812 
n absences     : 500 
AUC            : 0.7715721 
cor            : 0.3893624 
max TPR+TNR at : 2.169708 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 3: Tables showing the AUC and cor values of each model for species 1.</p>
<p>The results of evaluating the models using AUC and cor values matched those done by comparing the model AIC values. Model 4 had both the highest AUC and the highest correlation. However its cor values was just below 0.5 suggesting that the correlation between these model predictions and the observed distributions are of moderate strength at best. Potentially a model which combines data on precipitation and temperature might have provide more accurate predictions. This could also suggest that non-climate variables are also important in determining the distribution of fishers e.g.&nbsp;interactions with other species.</p>
<p>As model 4 is consistently shown to be the best model at predicting fisher distribution (out of those created in this analysis) this is the one which will be used to map current distribution of fishers.</p>
<p><u>Mapping current distribution:</u></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20species%201%20current%20distribution-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 4: Map showing the current distribution of species 1 based on predictions made from a GLM based on climate variables 13, 14, 15, and 16</figcaption>
</figure>
</div>
</div>
</div>
<p>The distribution predicted by the model matches the observed data to a certain extent. The high probabilities of occurence found across the entire East side of North America and along the Western coast, especially moving up into Canada both line up with the two main clusters of Fisher presence shown by the GBIF data. However the model misses the group of fishers which inhabit central Canada. On the Eastern coast the area’s of predicted high probability also extend further south and north than observed data. As model four only includes information on precipitation it is possible adding temperature would restrict the latitudinal range predicted by the model. While the model is able to accurately pick out areas with a high concentration of fishers it shows a two population, East vs West, pattern of distribution while the observed data is more of a continuous band across the centre of the region.</p>
</section>
<section id="species-2-north-american-porcupine" class="level4">
<h4 class="anchored" data-anchor-id="species-2-north-american-porcupine">Species 2 (North American Porcupine)</h4>
<p><u>Model Summaries and AIC:</u></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio1 + bio2 + bio3 + bio4, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 17.7454530  0.8292687  21.399  &lt; 2e-16 ***
bio1         0.0937286  0.0127141   7.372 1.68e-13 ***
bio2         0.7161859  0.0374884  19.104  &lt; 2e-16 ***
bio3        -0.4091885  0.0171782 -23.820  &lt; 2e-16 ***
bio4        -0.0105478  0.0005671 -18.601  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4576.4  on 18122  degrees of freedom
Residual deviance: 3805.3  on 18118  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 3815.3

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio5 + bio6 + bio7 + bio8, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.591e+00  4.159e-01   3.826  0.00013 ***
bio5         2.018e+04  3.895e+04   0.518  0.60436    
bio6        -2.018e+04  3.895e+04  -0.518  0.60436    
bio7        -2.018e+04  3.895e+04  -0.518  0.60436    
bio8        -4.306e-02  8.572e-03  -5.024 5.07e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4576.4  on 18122  degrees of freedom
Residual deviance: 4315.7  on 18118  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 4325.7

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio9 + bio10 + bio11 + bio12, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.0434867  0.3895950   5.245 1.56e-07 ***
bio9        -0.0008436  0.0074104  -0.114 0.909368    
bio10        0.0567173  0.0172092   3.296 0.000982 ***
bio11        0.0584096  0.0144245   4.049 5.14e-05 ***
bio12        0.0011515  0.0001414   8.144 3.83e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4576.4  on 18122  degrees of freedom
Residual deviance: 4280.3  on 18118  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 4290.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>Model containing climate variables 13, 14, 15 and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio13 + bio14 + bio15 + bio16, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.759644   0.274087  17.365  &lt; 2e-16 ***
bio13        0.005585   0.007070   0.790    0.429    
bio14        0.003568   0.004531   0.787    0.431    
bio15       -0.031327   0.004685  -6.687 2.27e-11 ***
bio16       -0.002493   0.002436  -1.023    0.306    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4576.4  on 18122  degrees of freedom
Residual deviance: 4286.5  on 18118  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 4296.5

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>Model containing climate variables 17, 18 and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio17 + bio18 + bio19, family = binomial(link = "logit"), 
    data = species2_env_pa_data)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.4242331  0.1221054  28.043  &lt; 2e-16 ***
bio17        0.0144135  0.0009603  15.010  &lt; 2e-16 ***
bio18       -0.0060207  0.0006205  -9.704  &lt; 2e-16 ***
bio19       -0.0018491  0.0004525  -4.086 4.39e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4576.4  on 18122  degrees of freedom
Residual deviance: 4291.0  on 18119  degrees of freedom
  (4 observations deleted due to missingness)
AIC: 4299

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 5: Tables showing summary statistics for each model of climate distribution on species 2 distribution.</p>
<p>For the North American Porcupine only three of the models are able to significantly predict occurrence, models 1, 4, 5. Although the predictive power of model 4 may mostly rely on just one variable, variable 15 (precipitation seasonality).</p>
<p>To compare how well each model predicts the presence/absence of the North American Porcupine an Akaike Information Criterion test was performed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              df      AIC
species2_glm1  5 3815.343
species2_glm2  5 4325.693
species2_glm3  5 4290.320
species2_glm4  5 4296.488
species2_glm5  4 4298.966</code></pre>
</div>
</div>
<p>Figure 6: Table comparing the AIC values of the models for species 2.</p>
<p>The model with the lowest AIC value is model 1, which indicates annual mean temperature, mean diurnal range, isothermality and temperature seasonality are all important factors in determining porcupine distribution. However as the other two models containing primarily variables linked to temperature had very limited predictive ability the role. of precipitation cannot fully be discounted as both models 4 and 5 had lower AICS than models 2 and 4. In general all of the models for species 2 had higher AIC’s than the models for species 1 which suggests that climate is not as important in controlling the range of porcupines as it is for fishers.</p>
<p><u>Evaluating AUC and correlation of models:</u></p>
<p>The ability of a models predictions to match the observed data can also be evaluated by looking at the area under the curve (AUC) and correlation (cor) values.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Model 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Model 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Model 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Model 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false" href="">Model 5</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Model containing variables 1, 2, 3, and 4.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 500 
AUC            : 0.6931716 
cor            : 0.2997251 
max TPR+TNR at : 3.509633 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Model containing climate variables 5, 6, 7, and 8.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 500 
AUC            : 0.6194445 
cor            : 0.1217853 
max TPR+TNR at : 2.827438 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>Model containing climate variables 9, 10, 11, and 12.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 500 
AUC            : 0.6346751 
cor            : 0.1355991 
max TPR+TNR at : 2.90342 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<p>Model containing climate variables 13, 14, 15 and 16.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 500 
AUC            : 0.7145985 
cor            : 0.135554 
max TPR+TNR at : 4.149287 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<p>Model containing climate variables 17, 18 and 19.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 17623 
n absences     : 500 
AUC            : 0.7043114 
cor            : 0.1265078 
max TPR+TNR at : 3.308458 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Figure 7: Tables showing the AUC and cor values of each model for species 2.</p>
<p>The results of the evaluation of AUC and cor values are consistent with the AIC values of the models, with model 1 showing the highest AUC and cor values. However the correlation of model one was around 0.3. Suggesting that even though it is the best model it is still quite poor at predicting porcupine distribution. Strengthening the argument that climate is not the main factor determining the range of the North American Porcupine. As it is the best model created in this analysis at explaining</p>
<p><u>Mapping current distribution:</u></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20species%202%20current%20distribution-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 8: Map showing the current distribution of Species 2 based on predictions made from a GLM based on climate variables 1, 2, 3, and 4</figcaption>
</figure>
</div>
</div>
</div>
<p>In general the observed data from the GBIF dataset matches with areas predicted by the model to have a high chance of occurence. However the model slightly under estimates the latitudinal range of the porcupine with several presence coordinates falling both above and below the main region of predicted occupation. The model also predicts that porcupines would be expected to be found in south-eastern America, however they are mostly absent from this region in the observed data. Compared to fishers porcupines have a much large range both in the predicted and observed datasets, being found throughout most of the region and most areas where fishers are also found.</p>
</section>
</section>
<section id="distribution-overlap" class="level2">
<h2 class="anchored" data-anchor-id="distribution-overlap">Distribution Overlap</h2>
<section id="plotting" class="level4">
<h4 class="anchored" data-anchor-id="plotting">Plotting</h4>
</section>
<section id="metrics" class="level4">
<h4 class="anchored" data-anchor-id="metrics">Metrics</h4>
</section>
</section>
<section id="modelling-interspecies-distribution-dependence" class="level2">
<h2 class="anchored" data-anchor-id="modelling-interspecies-distribution-dependence">Modelling Interspecies Distribution Dependence</h2>
</section>
<section id="future-distribution-prediction" class="level2">
<h2 class="anchored" data-anchor-id="future-distribution-prediction">Future Distribution Prediction</h2>
<p>To predict the future distribution of species future climate projections are required to provide data to run the previously created models on. The projection data used here was from CMIP5 (Coupled Model Intercomparison Project Phase 5), which is available here <a href="https://aims2.llnl.gov/search" class="uri">https://aims2.llnl.gov/search</a>.</p>
<section id="species-1" class="level4">
<h4 class="anchored" data-anchor-id="species-1">Species 1</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots results side by side</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Present distribution</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(species1_pred, <span class="at">main =</span> <span class="st">"Present Distribution of Species 1"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world_map, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"darkgrey"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Future distribution</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(species1_future_pred, <span class="at">main =</span> <span class="st">"Future Distribution of Species1"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world_map, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"darkgrey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Geodata_assignment_files/figure-html/Plotting%20future%20distributions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="species-2" class="level4">
<h4 class="anchored" data-anchor-id="species-2">Species 2</h4>
</section>
<section id="degree-of-overlap" class="level4">
<h4 class="anchored" data-anchor-id="degree-of-overlap">Degree of Overlap</h4>
</section>
</section>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>